<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>AR Marker Detection</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            overflow: hidden;
            background: #000;
        }

        #container {
            position: relative;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
        }

        #status {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 8px 12px;
            background: rgba(0,0,0,0.8);
            color: white;
            border-radius: 20px;
            font-size: 14px;
            z-index: 1000;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
        }

        #instructions {
            position: absolute;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 15px;
            border-radius: 15px;
            font-size: 14px;
            z-index: 1000;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
            text-align: center;
        }

        #marker-info {
            position: absolute;
            top: 60px;
            right: 10px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px;
            border-radius: 10px;
            font-size: 12px;
            z-index: 1000;
            max-width: 200px;
        }

        .marker-download {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            z-index: 1001;
            max-width: 80%;
        }

        .marker-download button {
            background: #007AFF;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            margin: 10px 5px;
            cursor: pointer;
        }

        .marker-image {
            width: 150px;
            height: 150px;
            border: 2px solid white;
            margin: 10px auto;
            display: block;
        }

        @media (max-width: 768px) {
            #instructions {
                font-size: 12px;
                padding: 12px;
                bottom: 15px;
                left: 15px;
                right: 15px;
            }
            
            .marker-image {
                width: 120px;
                height: 120px;
            }
        }
    </style>
</head>
<body>
    <div id="container">
        <a-scene 
            embedded 
            arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;"
            vr-mode-ui="enabled: false"
            renderer="logarithmicDepthBuffer: true;"
            style="width: 100vw; height: 100vh;">
            
            <!-- AR Marker -->
            <a-marker type="pattern" url="./marker.patt" id="marker" raycaster="objects: .clickable" emitevents="true" cursor="fuse: false; rayOrigin: mouse;">
                <!-- 3D Model -->
                <a-entity 
                    gltf-model="./tour360/ekana_stadium_low_poly_lucknow_city_game_asset.glb"
                    scale="0.1 0.1 0.1"
                    position="0 0.5 0"
                    animation="property: rotation; to: 0 360 0; loop: true; dur: 10000"
                    class="clickable">
                </a-entity>
                
                <!-- Lighting -->
                <a-light type="ambient" color="#ffffff" intensity="0.8"></a-light>
                <a-light type="directional" position="1 1 1" intensity="0.6" cast-shadow></a-light>
            </a-marker>

            <!-- Camera -->
            <a-entity camera></a-entity>
        </a-scene>

        <div id="status">ƒêang t√¨m marker...</div>
        <div id="marker-info">
            <div>üì± H∆∞·ªõng camera v√†o marker</div>
            <div>üîÑ Di chuy·ªÉn ƒë·ªÉ xem model</div>
            <div>üëÜ Ch·∫°m ƒë·ªÉ t∆∞∆°ng t√°c</div>
        </div>
        <div id="instructions">
            üìã T·∫£i marker pattern ‚Üí üì± H∆∞·ªõng camera v√†o marker ‚Üí üéÆ T∆∞∆°ng t√°c v·ªõi model 3D
        </div>
        <div id="marker-download" class="marker-download" style="display: none;">
            <h3>üìã AR Marker Pattern</h3>
            <p>T·∫£i marker pattern n√†y ƒë·ªÉ s·ª≠ d·ª•ng AR:</p>
            <img src="./marker.patt" class="marker-image" alt="AR Marker">
            <br>
            <button onclick="downloadMarker()">üì• T·∫£i Marker</button>
            <button onclick="hideMarkerDownload()">‚ùå ƒê√≥ng</button>
            <p style="font-size: 12px; margin-top: 10px;">
                In marker n√†y ra gi·∫•y ho·∫∑c hi·ªÉn th·ªã tr√™n m√†n h√¨nh kh√°c
            </p>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/gh/aframevr/aframe@1c2407b26c61958baa93967b5412487cd94b290b/dist/aframe-master.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
    
    <script>
        let isMarkerDetected = false;
        const status = document.getElementById('status');
        const instructions = document.getElementById('instructions');
        const markerInfo = document.getElementById('marker-info');
        const markerDownload = document.getElementById('marker-download');

        // Initialize AR
        function initAR() {
            console.log('AR.js initialized');
            status.textContent = 'AR s·∫µn s√†ng - T√¨m marker...';
            
            // Check for marker detection
            const marker = document.querySelector('#marker');
            
            marker.addEventListener('markerFound', () => {
                isMarkerDetected = true;
                status.textContent = '‚úÖ Marker detected';
                instructions.textContent = 'üéÆ Model ƒë√£ hi·ªÉn th·ªã - Di chuy·ªÉn camera ƒë·ªÉ xem t·ª´ c√°c g√≥c ƒë·ªô kh√°c nhau';
                markerInfo.style.display = 'block';
            });
            
            marker.addEventListener('markerLost', () => {
                isMarkerDetected = false;
                status.textContent = '‚ùå Marker lost';
                instructions.textContent = 'üìã T·∫£i marker pattern ‚Üí üì± H∆∞·ªõng camera v√†o marker ‚Üí üéÆ T∆∞∆°ng t√°c v·ªõi model 3D';
                markerInfo.style.display = 'none';
            });

            // Add click interaction
            marker.addEventListener('click', (event) => {
                const model = event.detail.intersectedEl;
                if (model) {
                    // Toggle model animation
                    const currentAnimation = model.getAttribute('animation');
                    if (currentAnimation) {
                        model.removeAttribute('animation');
                    } else {
                        model.setAttribute('animation', 'property: rotation; to: 0 720 0; loop: true; dur: 2000');
                    }
                }
            });
        }

        // Download marker function
        function downloadMarker() {
            const link = document.createElement('a');
            link.href = './marker.patt';
            link.download = 'ar_marker.patt';
            link.click();
        }

        // Show/hide marker download
        function showMarkerDownload() {
            markerDownload.style.display = 'block';
        }

        function hideMarkerDownload() {
            markerDownload.style.display = 'none';
        }

        // Add marker download button
        setTimeout(() => {
            const downloadBtn = document.createElement('button');
            downloadBtn.innerHTML = 'üìã T·∫£i Marker';
            downloadBtn.style.cssText = `
                position: absolute;
                top: 10px;
                left: 10px;
                padding: 8px 12px;
                background: rgba(0,0,0,0.8);
                color: white;
                border: none;
                border-radius: 20px;
                font-size: 12px;
                z-index: 1000;
                cursor: pointer;
            `;
            downloadBtn.onclick = showMarkerDownload;
            document.body.appendChild(downloadBtn);
        }, 1000);

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initAR);
        
        // Handle window resize
        window.addEventListener('resize', () => {
            const scene = document.querySelector('a-scene');
            if (scene) {
                scene.style.width = window.innerWidth + 'px';
                scene.style.height = window.innerHeight + 'px';
            }
        });
    </script>
</body>
</html>
